# x) Tiivistelmät

# a) Totally Legit Sertificate. Asenna OWASP ZAP, generoi CA-sertifikaatti ja asenna se selaimeesi. Laita ZAP proxyksi selaimeesi. Laita ZAP sieppaamaan myös kuvat, niitä tarvitaan tämän kerran kotitehtävissä. Osoita, että hakupyynnöt ilmestyvät ZAP:n käyttöliittymään. (Ei toimine localhost:lla ilman Foxyproxya)

Aloitin zapin asennuksen komennolla `sudo apt-get install zaproxy`.

![Screenshot](https://github.com/user-attachments/assets/4cab6d9f-8986-451a-8cb8-aba93997d912)

Seuraavaksi avasin zapin käyttöliittymästä valikon tools -> options -> network -> Server Certificates -> tallensin kotikansioon.

![Screenshot](https://github.com/user-attachments/assets/71eee43b-89cc-4b88-90db-59b8bc17156e)

Tämän jälkeen selaimessa Settings -> Privacy & Security -> Certificates -> View Sertificates -> import -> valitaan oikea sertifikaatti. 

![Screenshot](https://github.com/user-attachments/assets/307ab2f4-33f3-4b14-bcf7-25f41260cf71)

Sitten valitaan "trust this CA to identify websites" ja "trust this CA to identify email users". 

![Screenshot](https://github.com/user-attachments/assets/c6d39f5c-a5f6-4d0f-b32f-52aa94de95b3)

Nyt sertifikaatti näkyy listalla:

![Screenshot](https://github.com/user-attachments/assets/9e32fe14-2a3b-4a30-bf33-bdbaf03d0d7c)

Tämän jälkeen laitetaan ZAP proxyksi selaimeen. Valitaan selaimessa settings -> network settings -> manual proxy configuration. 

![Screenshot](https://github.com/user-attachments/assets/70a39352-9dbf-4951-9ad2-bc53d616a749)

Kuvien sieppaamiseksi zappiin valitsin zapista tools -> options -> display -> täppä kohtaan process images in http requests/responses. 

![Screenshot](https://github.com/user-attachments/assets/8f1a952c-0d47-4bca-af55-06790c36a1ba)


Nyt hakupyynnöt ilmestyvät zappiin:

![Screenshot](https://github.com/user-attachments/assets/e6b32649-a99f-4651-b18d-55ab5c1454f5)


# b) Kettumaista. Asenna "FoxyProxy Standard" Firefox Addon, ja lisää ZAP proxyksi siihen. Käytä FoxyProxyn "Patterns" -toimintoa, niin että vain valitsemasi weppisivut ohjataan Proxyyn. (Läksyssä ohjataan varmaankin PortSwigger Labs ja localhost.)

Firefoxissa settings -> extensions & themes -> find more add-ones -> kirjoitetaan hakukenttään foxyproxy -> valitaan foxyproxy standard -> add to firefox.

![Screenshot](https://github.com/user-attachments/assets/d4bb5499-3299-4b3d-ba41-918e17ddf4c6)

Valitaan selaimessa extensions -> foxyproxy -> options -> proxies -> add. Laitoin alla olevan kuvan mukaiset asetukset:

![Screenshot](https://github.com/user-attachments/assets/8fc14fc7-02ca-4ec1-b0be-c78e2a2aeb2a)

Lopuksi sääntöperusteinen foxyproxy otetaan käyttöön selaimessa extensions -> foxyproxy -> foxyproxy by patterns:

![Screenshot](https://github.com/user-attachments/assets/e33ba1fa-8026-4c42-a9f3-d5825765842c)

Nyt hakupyynnöt eivät enää ohjaudu zappiin:

![Screenshot](https://github.com/user-attachments/assets/cfc404dd-977a-4175-91e9-e6405acd93aa)


# PortSwigger Labs. Ratkaise tehtävät.

### c) Insecure direct object references

Tehtävän tarkoitus oli selvittää tietyn käyttäjän salasana ja kirjautua kyseisen käyttäjän tilille. Tehtävän verkkosivusto säilyttää chatin lokeja suoraan palvelimen tiedostorakenteessa, josta niitä voidaan hakea staattisen urlin avulla. 

Aluksi yritin selvittää tiedostopolun, mistä chatin loki sijaitsee. Tämä tapahtui lähettämällä sivustolla chat-viesti ja tämän jälkeen pystyin lataamaan transskriptin. Katsoin zapista get pyyntöjä. 

![Screenshot](https://github.com/user-attachments/assets/a148c7cf-7733-43a7-a9a6-3a3227fa8adb)

Kokeilin vaihtaa urlin tiedostonimeä ja painoin send. Vastaukseksi sain jonkun toisen chat-keskustelun, josta pystyin pomimaan salasanan.

![Screenshot](https://github.com/user-attachments/assets/495bce41-6feb-4af7-a47d-479fed1eeae7)

Laitoin kirjautumiskohtaan käyttäjänimen carlos ja saadun salasanan.

![Screenshot](https://github.com/user-attachments/assets/d189d35f-0e2f-4eb4-908e-fc3842a48a60)

Tehtävä ratkaistu!

![Screenshot](https://github.com/user-attachments/assets/6825b6cc-05d0-45ce-b1cd-ed13b3cbce29)

Tässä tehtävässä sovellus ei tarkista, että onko käyttäjällä oikeus lukea tiedostoja. Palvelimen tiedostojärjestemään pääsee käsiksi muokkaamalla urlia ja kun chat-tiedostot nimetään kaikki samalla logiikalla, niin tiedoston nimen pystyy arvaamaan ja toisten keskusteluja voi päästä lukemaan.

## Path traversal

### d) File path traversal, simple case

Tehtävän tarkoituksena on päästä käsiksi /etc/passwd -tiedoston sisältöön. Tehtävänannossa oli mainittu, että haavoittuvuus sijaitsee kuvatiedostoissa, joten etsin zapista kuvatiedostoihin liittyviä hakupyyntöjä. Hakupyyntöön liittyviä urleja on mahdollista muokata, jolloin muokkasin kuvan hakuun liittyvää filename kohtaa:

![Screenshot](https://github.com/user-attachments/assets/2e6bd42e-5ee8-49fc-9ce8-b576eacc5f21)

Painamalla send saadaan vastauksena haluttu tiedosto.


![Screenshot from 2024-11-24 20-40-38](https://github.com/user-attachments/assets/e318a454-39e3-4647-a9e3-5b46ddffd90c)


![Screenshot](https://github.com/user-attachments/assets/b8600500-2ae9-49b0-9768-5f564eb72db0)


Haavoittuvuus johtuu siitä, että urlia muokkaamalla pääsee liikkumaan hakemistopolussa. Sovellus ei rajoita tiedostopolun muokkaamista eikä sovellus tarkista tiedostojen lukuoikeuksia. 


### e) File path traversal, traversal sequences blocked with absolute path bypass

Tehtävässä pyritään pääsemään käsiksi /etc/passwd-tiedoston sisältöön. Tehtävä oli saman tyyppinen kuin edellinen, joten etsin zapista kuviin liittyviä hakupyyntöjä. Muokkasin filename-kohtaa ja pääsin käsiksi haluttuun tiedostoon.

![Screenshot](https://github.com/user-attachments/assets/52f175e4-5f94-42f8-b0be-93a1230a79cf)

![Screenshot](https://github.com/user-attachments/assets/6d2f2ad5-3c9f-462b-bc5d-ab460715d8af)

Tässä tehtävässä hakemistojen välillä ei pysty liikkumaan, mutta kirjoittamalla urliin absoluuttisen polun, pystyy haluttuun tiedostoon pääsemään käsiksi.

### f) File path traversal, traversal sequences stripped non-recursively



## Server Side Template Injection (SSTI)

### g) Server-side template injection with information disclosure via user-supplied objects (Tämä on merkitty hieman vaikeammaksi, jätä viimeiseksi jos näyttää hankalalta)

## Server Side Request Forgery (SSRF)


### h) Basic SSRF against the local server

Tehtävän tarkoituksena on poistaa käyttäjä carlos. Tuotesivulta löytyy saatavuuden tarkistuksen, jota klikkaamalla zappiin ilmestyy get- ja post -pyyntöjä ja vastauksia. 

![Screenshot](https://github.com/user-attachments/assets/8cb7665b-31d2-4113-b7e7-ee3b9b4f2d5e)

Kuvassa alhaalla olevaa stockApia voi muuttaa ja lisäsin sinne tehtävässä annetun linkin:

![Screenshot](https://github.com/user-attachments/assets/ca96d2a1-8b36-498a-ac45-6651f3d66045)

Muokkasin stockApia vielä uudelleen vastauksena saadun endpointin perusteella:

![Screenshot](https://github.com/user-attachments/assets/90f8e69f-a999-47a0-8ec3-f4f2fd65fa88)

Carlos poistettiin onnistuneesti:

![Screenshot](https://github.com/user-attachments/assets/0960b508-2ead-4562-945e-2237ec02b369)


## Cross Site Scripting (XSS)

### i) Reflected XSS into HTML context with nothing encoded


### j) Stored XSS into HTML context with nothing encoded 

# k) Asenna pencode ja muunna sillä jokin merkkijono (encode a string).
